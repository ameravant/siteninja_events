- content_for :head do
  = javascript_include_tag "/plugin_assets/siteninja_events/javascripts/admin_events_form.js"
  %style{:type => "text/css"}
    ==#categories { padding: 5px; border: 1px solid #ccc; background: #fff; color: #333; position: absolute; width: 200px; font-size: .9em; height: 150px; overflow: auto; -moz-box-shadow: 0 4px 10px rgba(0,0,0,.6); -webkit-box-shadow: 0 4px 10px rgba(0,0,0,.6); box-shadow: 0 4px 10px rgba(0,0,0,.6); display: none; }
  :javascript
    function addtext(text) {
    tinyMCE.execInstanceCommand("event_description","mceInsertContent",false,text);
    }
= error_messages_for "event"
- @calendar_select = true
-if @controller.action_name == 'edit' && @cms_config['features']['event_registration'] && current_user.has_role("Admin")
  %p
    = icon "Plus", new_admin_event_event_price_option_path(@event)
    = link_to "Add a new price option for this event", new_admin_event_event_price_option_path(@event)
#main-details.options
  #options
    %h3 Event Details
    %dl
      %dt.form-label
        = f.label :address
        = render :partial => 'admin/shared/help_tip', :locals =>{:tip_headline => "", :tip_text => "This will be shown on the event page and used to display a map (optional)."}
      %dd.form-option
        = f.text_field :address, :class => "small-input"
      %dt.form-label= f.label :date_and_time, "Start Date/Time"
      %dd.form-option= f.text_field(:date_and_time, :value => (@event.date_and_time.blank? ? Time.now.strftime("%m/%d/%Y %I:%M %p") : @event.date_and_time.strftime("%m/%d/%Y %I:%M %p")), :class => "datetimepicker small-input")
      %dt.form-label= f.label :end_date_and_time, "End Date/Time"
      %dd.form-option= f.text_field(:end_date_and_time, :value => (@event.end_date_and_time.blank? ? Time.now.strftime("%m/%d/%Y %I:%M %p") : @event.end_date_and_time.strftime("%m/%d/%Y %I:%M %p")), :class => "datetimepicker small-input")
      -if !@event_categories.blank?
        %dt.form-label
          = f.label :event_category_ids, link_to("Assign Categories", "javascript:void(0)", :id => "display-categories", :onclick => "jQuery('#categories').slideToggle(500);")
          #categories
            %img{:src =>"#{css_icon("Cancel","","16x16","red")}", :title =>"close", :alt=> "close box icon", :class => "close-icon", :onclick => "jQuery('#categories').slideUp()"}
            - for event_category in @event_categories
              .event_category_checkbox
                = check_box_tag "event[event_category_ids][]", event_category.id, @event.event_categories.include?(event_category), :id => dom_id(event_category)
                = label_tag dom_id(event_category), "#{event_category.title}"
      %dt.form-label
        = f.check_box :active, :disabled => @disabled
        = f.label :active, "Publish Event to Public"

%h2.title.form-label= f.label :name, "Event Title"
= f.text_field :name, :class => "big-input"



%h2= f.label :blurb, "Blurb"
= f.text_area :blurb, :class => "big-area blurb"

- if @cms_config['features']['event_registration'] and current_user.has_role("Admin")
  %br
  %div
    %div#registration-ops
      = f.check_box :registration
      %label{ :for => "event_registration" }
        Enable Registration
    %div.registration-options
      %h2 Registration Options

      #registration_limit
        %br
        %div
          = f.label :registration_limit, "Registration Limit"
          = f.text_field :registration_limit, :size => 4
          %span guests
          %span.small.gray
            \&mdash; optional
        %br
        %div
          = f.label :registration_deadline, "Deadline to register"
          = f.text_field(:registration_deadline, :value => (@event.registration_deadline.blank? ? "" : @event.registration_deadline.strftime("%m/%d/%Y %I:%M %p")), :class => "datetimepicker")
        %br
        %div
          =f.label :registration_closed_text, "Message to display when registration is full or past the deadline and now closed:"
        %div
          = f.text_area :registration_closed_text, :size => "60x4", :class => "mceEditor"
      #price
        -fields_for :event_price_options do |p|
          =p.label :price, "Price"
          =p.text_field :price
          =p.hidden_field :title, :value =>"Standard"
          %span.note Leave blank if event is free
          %br
          =p.label :public, "Show this price to the public?"
          =p.check_box :public, :checked => "checked"
      #payments-allowed
        %h3
          Accepted Payments
        %div
          = f.check_box :allow_card
          %label{ :for => "event_allow_card" }
            Allow credit card payment via Google Checkout
          %span.small.gray
            \&mdash; must have Google Checkout configured in
            = link_to "settings", edit_admin_setting_path(:anchor => "Advanced")
            under the 'Advanced' tab
        %div
          = f.check_box :allow_cash
          %label{ :for => "event_allow_cash" }
            Allow cash payment
          %span.small.gray
            \&mdash; only if registration is required
        %div.checks
          = f.check_box :allow_check
          %label{ :for => "event_allow_check" }
            Allow check payment
          %span.small.gray
            \&mdash; only if registration is required
        %div
          = f.check_box :allow_other
          %label{ :for => "event_allow_other" }
            Allow other
          %span.small.gray
            \&mdash; Use this option for any other payment types
        #check-payment-options          
          %h3= f.label :check_instructions, "Check Instructions"
          = f.text_area :check_instructions, :size => "60x8", :class => "mceEditor"
          %p
            ==Let registrants know any pertinent information relating to payment for the #{@cms_config['site_settings']['event_title']}.
        /check-payment-options
      /payments-allowed


= clear
#body-wrapper
  .options#body-details
    .inserts
      %strong Insert:
      %br
      = render :partial => "admin/shared/parser_help"
      - unless @event.title.blank?
        = link_to("#{icon('Picture')} Attached Image", admin_event_images_path(@event, :fancy => "true"), :class => "fancy-iframe")
      = render :partial => "admin/shared/asset_options"
      = render :partial => "admin/shared/insert_map"

  %div{:style => "width: 560px;"}
    %h2.form-label
      = f.label :description

  = f.text_area :description, :size => "100x40", :class => "mceEditor"


- fancy_submit admin_events_path do
  = f.submit "Save #{@cms_config['site_settings']['event_title']}"

